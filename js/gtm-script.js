class gTagEvents{constructor(){this.delegateBody=new Delegate(document.body),this.bindEvents(),this.observeDOMChanges(),this.handleIntersects(),this.germanCheck()}germanCheck(){const redirected=localStorage.getItem("deRedirected");if(console.log("gTagEvents: Checking for redirected flag in window. Redirected: ",redirected),redirected){const payload={event:"custom_utm_redirected",redirected};dataLayer.push(payload),console.log("gTagEvents: Redirected flag sent:",payload.redirected),localStorage.removeItem("deRedirected")}}bindEvents(){this.delegateBody.on("filters:applied",this.sendFiltersData.bind(this)),this.delegateBody.on("filters:cleared",this.clearFiltersData.bind(this)),this.delegateBody.on("click",'[data-action="apply-sort"]',this.sendSortByData.bind(this)),this.delegateBody.on("click",'[name="checkout"]',this.handleCheckout.bind(this)),this.delegateBody.on("click",'[data-ga="ga-send-select"]',this.handleSelectItem.bind(this)),this.delegateBody.on("click",'[data-action="remove-item"]',this.removeFromCart.bind(this)),this.delegateBody.on("click",'[data-action="remove-group"]',this.removeFromCart.bind(this)),document.addEventListener("cart:add",this.sendAddToCart.bind(this))}sendSortByData(){const input=event.target.closest("input")||document.querySelector('input[name="sort_by"]:checked');input&&this.lastSortBy!==input.value&&(this.lastSortBy=input.value,dataLayer.push({event:"sort_applied",sort_by:input.value}))}sendFiltersData(){const filtersList=[];document.querySelectorAll(".inputFilterCheckbox:checked").forEach(checkbox=>{filtersList.push(checkbox.dataset.filterName+":"+checkbox.dataset.optionLabel)}),filtersList.length&&JSON.stringify(this.lastFiltersList)!==JSON.stringify(filtersList)&&(this.lastFiltersList=filtersList,dataLayer.push({event:"filter_applied",filter_by:filtersList}))}clearFiltersData(){dataLayer.push({event:"clear_filters",filter_by:[]}),this.sendSortByData()}sendAddToCart(){const items=event.detail;if(dataLayer){dataLayer.push({ecommerce:null});let ecommerceData={event:"add_to_cart_custom",ecommerce:{value:0,items:[]}};items.forEach(item=>{const price=parseInt(item.price/100),quantity=parseInt(item.quantity);ecommerceData.ecommerce.items.push({item_id:item.sku,item_variant:item.variantTitle,item_name:item.productName,price,quantity}),ecommerceData.ecommerce.value+=price*quantity}),dataLayer.push(ecommerceData)}}handleIntersects(){document.body.querySelectorAll("[data-gtag-intersection]").forEach(item=>{item.dataset.observed!=="true"&&(new IntersectionObserver(this.handleIntersection.bind(this),{root:null,rootMargin:"0px",threshold:.1}).observe(item),item.dataset.observed="true")})}observeDOMChanges(){new MutationObserver((mutationsList,observer2)=>{for(const mutation of mutationsList)mutation.addedNodes.length&&this.handleIntersects()}).observe(document.body,{childList:!0,subtree:!0,attributes:!1})}handleIntersection(entries){entries.forEach(entry=>{if(entry.isIntersecting){let data=!1;try{data=JSON.parse(entry.target.querySelector('script[type="application/ld+json"]').textContent)}catch(e){console.log("JSON parse failed",e)}if(!dataLayer||!data)return;dataLayer.push({ecommerce:null}),dataLayer.push(data)}})}handleCheckout(){const target=document.querySelector(".cartCheckout--Button"),settings=JSON.parse(target.dataset.settings);!dataLayer||!settings||(dataLayer.push({ecommerce:null}),dataLayer.push(settings))}handleSelectItem(event2){let target=event2.target;if(event2.target.classList.contains("product-card_favorites-container"))return;event2.target.dataset.ga!="ga-send-select"&&(target=event2.target.closest('[data-ga="ga-send-select"]'));const settings=JSON.parse(target.dataset.settings);!dataLayer||!settings||dataLayer.push({event:"select_item",selected_item_list_id:settings.list_id,selected_item_list_name:settings.list_name,selected_items:[{item_id:settings.item_id,item_name:settings.item_name,price:settings.price,item_list_id:settings.list_id,item_list_name:settings.list_name}]})}removeFromCart(event2){let target=event2.target;const settings=JSON.parse(target.closest("[data-remove]").dataset.remove);!dataLayer||!settings||dataLayer.push({event:"remove_from_cart",remove:{value:settings.value,items:[{item_id:settings.item_id,item_name:settings.item_name,price:settings.price,quantity:settings.quantity}]}})}static sendSignal(redirected){window.dataLayer&&window.dataLayer.push({event:"utm_redirected",redirected:!!redirected})}}new gTagEvents;
//# sourceMappingURL=/cdn/shop/t/85/assets/gtm-script.js.map?v=15595096096632930241751283023
